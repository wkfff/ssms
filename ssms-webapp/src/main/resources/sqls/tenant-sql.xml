<?xml version="1.0" encoding="UTF-8" ?>

<sqlGroup name="tenant">
    <sqlGroup name="templateFolder">
        <sql id="getFolderByTemplateId">
            SELECT CONCAT('D-',CONVERT(SID,CHAR)) SID, C_NAME, N_COUNT, IFNULL(N_STATE,0) N_STATE,CONCAT('D-',CONVERT(R_SID,CHAR)) R_SID, NULL C_URL, N_INDEX
            FROM SSM_STDTMP_FOLDER
            WHERE R_TEMPLATE = ? AND R_TENANT=? AND P_TENANT=?
            UNION ALL
            SELECT CONCAT('F-',CONVERT(SID,CHAR)) SID, C_NAME, N_COUNT, IFNULL(N_STATE,0) N_STATE,CONCAT('D-',CONVERT(R_SID,CHAR)) R_SID, CONCAT('stdtmp_file_',P_TMPFILE,'/?sid=', CONVERT(SID, CHAR)) C_URL, N_INDEX
            FROM SSM_STDTMP_FILE
            WHERE R_SID IN (
                SELECT SID FROM SSM_STDTMP_FOLDER
                WHERE R_TEMPLATE = ? AND R_TENANT=? AND P_TENANT=?
            )
            ORDER BY N_INDEX, SID
        </sql>
        <sql id="getFolderByTemplateIdAndVersion">
            SELECT CONCAT('D-',CONVERT(SID,CHAR)) SID, C_NAME, N_COUNT, IFNULL(N_STATE,0) N_STATE,CASE IFNULL(N_STATE,0) WHEN  0 THEN '未创建'  WHEN 1 THEN '删除'  WHEN 2 THEN '更新' END S_STATE, CONCAT('D-',CONVERT(R_SID,CHAR)) R_SID, NULL C_URL,NULL P_TMPFILE,SID ID,T_UPDATE, N_INDEX
            FROM SSM_STDTMP_FOLDER
            WHERE R_TEMPLATE = ? AND R_TENANT=? AND P_TENANT=? AND IFNULL(N_VERSION,0)=?
            UNION ALL
            SELECT CONCAT('F-',CONVERT(SID,CHAR)) SID, C_NAME, N_COUNT, IFNULL(N_STATE,0) N_STATE,CASE IFNULL(N_STATE,0) WHEN  0 THEN '未创建'  WHEN 1 THEN '删除'  WHEN 2 THEN '更新' END S_STATE,CONCAT('D-',CONVERT(R_SID,CHAR)) R_SID, CONCAT('stdtmp_file_',P_TMPFILE,'/view?sid=', CONVERT(SID, CHAR)) C_URL,P_TMPFILE,SID ID,T_UPDATE, N_INDEX
            FROM SSM_STDTMP_FILE
            WHERE R_SID IN (
                SELECT SID FROM SSM_STDTMP_FOLDER
                WHERE R_TEMPLATE = ? AND R_TENANT=? AND P_TENANT=? AND IFNULL(N_VERSION,0)=?
            )
            ORDER BY N_INDEX, SID
        </sql>
        <sql id="seeFolderByTemplateId">
            SELECT CONCAT('D-',CONVERT(SID,CHAR)) SID, C_NAME, N_COUNT, IFNULL(N_STATE,0) N_STATE,CASE IFNULL(N_STATE,0) WHEN  0 THEN '未创建'  WHEN 1 THEN '删除'  WHEN 2 THEN '更新' END S_STATE, CONCAT('D-',CONVERT(R_SID,CHAR)) R_SID, NULL C_URL,T_UPDATE
            FROM SSM_STDTMP_FOLDER
            WHERE R_TEMPLATE = ? AND R_TENANT=? AND P_TENANT=?
            UNION ALL
            SELECT CONCAT('F-',CONVERT(SID,CHAR)) SID, C_NAME, N_COUNT, IFNULL(N_STATE,0) N_STATE,CASE IFNULL(N_STATE,0) WHEN  0 THEN '未创建'  WHEN 1 THEN '删除'  WHEN 2 THEN '更新' END S_STATE,CONCAT('D-',CONVERT(R_SID,CHAR)) R_SID, CONCAT('stdtmp_file_',P_TMPFILE,'/view?sid=', CONVERT(SID, CHAR)) C_URL,T_UPDATE
            FROM SSM_STDTMP_FILE
            WHERE R_SID IN (
                SELECT SID FROM SSM_STDTMP_FOLDER
                WHERE R_TEMPLATE = ? AND R_TENANT=? AND P_TENANT=?
            )
        </sql>
        <sql id="getFolderByFolderTmp">SELECT * FROM SSM_STDTMP_FOLDER WHERE R_SOURCE=? AND R_TENANT=? AND P_TENANT=? AND P_PROFESSION=? AND R_TEMPLATE=?</sql>
    </sqlGroup>
    <sqlGroup name="templateFile">
        <sql id="getFileByFileTmp">SELECT * FROM SSM_STDTMP_FILE WHERE R_SOURCE=? AND R_SID=? AND R_TENANT=? AND P_TENANT=? AND P_PROFESSION=? AND R_TEMPLATE=?</sql>
    </sqlGroup>
    
    <sqlGroup name="grade">
        <sql id="getDataFromEnterprise">
            SELECT C_CATEGORY,C_PROJECT,C_REQUEST,C_CONTENT,N_SCORE,C_METHOD,C_DESC,N_SCORE_REAL FROM SSM_GRADE_E_D 
            WHERE R_TENANT=? 
            AND R_SID=(select SID from SSM_GRADE_E_M where N_STATE=1 order by T_START desc limit 1 )
        </sql>
        <sql id="insertToReview">insert into ssm_grade_r_d (R_SID,C_DESC,N_SCORE_REAL) values(?,?,?,?)</sql>
    </sqlGroup>
</sqlGroup>
